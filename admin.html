<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>&#193;rea do administrador</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .admin-panel {
      max-width: 820px;
      margin: 0 auto;
      width: 100%;
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
      color: var(--ink);
    }

    .admin-table th,
    .admin-table td {
      text-align: left;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(215, 180, 106, 0.18);
      overflow-wrap: anywhere;
      word-break: break-word;
    }

    .admin-table th {
      color: var(--accent);
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    .admin-table tbody tr:hover {
      background: rgba(215, 180, 106, 0.06);
    }

    .client-link {
      background: none;
      border: none;
      color: var(--accent);
      font: inherit;
      padding: 0;
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: 3px;
    }

    .admin-table .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.78rem;
      background: rgba(215, 180, 106, 0.16);
      color: var(--accent);
      border: 1px solid rgba(215, 180, 106, 0.3);
    }

    .admin-table tr.is-paid {
      background: rgba(215, 180, 106, 0.08);
    }

    .admin-table tr.is-paid .status-pill {
      background: rgba(120, 208, 160, 0.2);
      color: #78d0a0;
      border-color: rgba(120, 208, 160, 0.4);
    }

    .mark-paid-btn {
      font-size: 0.8rem;
      padding: 8px 12px;
      min-width: 140px;
    }

    .toast {
      position: fixed;
      right: 18px;
      bottom: 20px;
      background: rgba(20, 17, 30, 0.95);
      color: var(--ink);
      border: 1px solid rgba(120, 208, 160, 0.5);
      border-radius: 14px;
      padding: 12px 16px;
      box-shadow: 0 18px 30px rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0;
      transform: translateY(12px);
      pointer-events: none;
      transition: opacity 0.25s ease, transform 0.25s ease;
      z-index: 5;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .toast-icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 1px solid rgba(120, 208, 160, 0.6);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #78d0a0;
      font-weight: 600;
      font-size: 0.9rem;
      flex-shrink: 0;
    }

    .admin-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 6;
    }

    .admin-modal.open {
      display: flex;
    }

    .admin-modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(10, 8, 18, 0.7);
    }

    .admin-modal-panel {
      position: relative;
      width: min(420px, 92vw);
      background: linear-gradient(160deg, rgba(21, 17, 33, 0.98), rgba(15, 12, 23, 0.98));
      border-radius: var(--radius);
      padding: 22px;
      border: 1px solid rgba(215, 180, 106, 0.22);
      box-shadow: 0 22px 44px rgba(0, 0, 0, 0.45);
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1;
    }

    .admin-modal-panel h2 {
      font-size: 1.2rem;
      color: var(--accent);
    }

    .admin-modal-subtitle {
      color: var(--muted);
      font-size: 0.92rem;
    }

    .admin-modal-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .admin-modal-form label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .admin-modal-form input {
      background: rgba(10, 8, 18, 0.85);
      border: 1px solid rgba(215, 180, 106, 0.25);
      border-radius: 10px;
      padding: 10px 12px;
      color: var(--ink);
      font-size: 0.95rem;
    }

    .admin-modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      flex-wrap: wrap;
    }

    .admin-form-row {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
    }

    .admin-form-row label {
      flex: 1 1 200px;
    }

    .admin-form-row select {
      background: rgba(10, 8, 18, 0.85);
      border: 1px solid rgba(215, 180, 106, 0.25);
      border-radius: 10px;
      padding: 10px 12px;
      color: var(--ink);
      font-size: 0.95rem;
    }

    .admin-actions {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .admin-actions a {
      text-decoration: none;
      color: var(--accent);
    }

    .admin-table-wrap {
      margin-top: 16px;
      width: 100%;
      overflow-x: auto;
    }

    .parcel-summary {
      display: grid;
      gap: 6px;
      font-size: 0.92rem;
      color: var(--muted);
    }

    .parcel-summary strong {
      color: var(--ink);
      font-weight: 600;
    }

    .parcel-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 0.9rem;
    }

    .parcel-table th,
    .parcel-table td {
      text-align: left;
      padding: 8px 10px;
      border-bottom: 1px solid rgba(215, 180, 106, 0.2);
    }

    .parcel-table th {
      color: var(--accent);
      font-weight: 600;
    }

    @media (max-width: 720px) {
      .admin-table {
        font-size: 0.85rem;
      }

      .admin-table th,
      .admin-table td {
        padding: 8px 10px;
      }

      .admin-actions {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    @media (max-width: 560px) {

      .admin-table,
      .admin-table thead,
      .admin-table tbody,
      .admin-table th,
      .admin-table td,
      .admin-table tr {
        display: block;
        width: 100%;
      }

      .admin-table thead {
        display: none;
      }

      .admin-table tr {
        background: rgba(20, 17, 30, 0.78);
        border-radius: 12px;
        margin-bottom: 12px;
        padding: 8px 0;
        border: 1px solid rgba(215, 180, 106, 0.18);
      }

      .admin-table td {
        border: none;
        padding: 6px 12px;
        display: flex;
        flex-wrap: wrap;
        gap: 4px 12px;
        align-items: baseline;
      }

      .admin-table td::before {
        content: attr(data-label);
        display: inline-block;
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--muted);
        margin-bottom: 0;
      }
    }
  </style>
</head>

<body>
  <div class="bg-orb orb-1"></div>
  <div class="bg-orb orb-2"></div>
  <div class="noise"></div>

  <div class="page">
    <main class="wrap">
      <div class="top-actions">
        <a class="cta-btn" href="index.html">Voltar</a>
      </div>

      <header class="hero">
        <div class="brand-mark" aria-hidden="true">
          <span class="brand-sigil"></span>
        </div>
        <p class="eyebrow">Administra&#231;&#227;o</p>
        <h1>P&#225;gina do administrador</h1>
        <p class="subtitle">Cadastre clientes e acompanhe parcelas.</p>
      </header>

      <section class="intent admin-panel">
        <h3>Adicionar cliente</h3>
        <form id="adminClientForm" class="modal-form">
          <div class="admin-form-row">
            <label>
              Cliente
              <input type="text" name="cliente" id="cliente" placeholder="Digite aqui..." required />
            </label>
            <label>
              Quantidade de parcelas
              <select name="parcelas" id="parcelas" required>
                <option value="">Selecione</option>
                <option value="1">1x</option>
                <option value="2">2x</option>
                <option value="3">3x</option>
                <option value="4">4x</option>
                <option value="5">5x</option>
                <option value="6">6x</option>
                <option value="7">7x</option>
                <option value="8">8x</option>
                <option value="9">9x</option>
                <option value="10">10x</option>
                <option value="11">11x</option>
                <option value="12">12x</option>
              </select>
            </label>
          </div>
          <div class="admin-form-row">
            <label>
              Valor devedor (R$)
              <input type="text" name="valor" id="valor" inputmode="numeric" placeholder="0,00" required />
            </label>
            <label>
              Forma de pagamento
              <select name="pagamento" id="pagamento" required>
                <option value="">Selecione</option>
                <option value="pix">Pix</option>
                <option value="dinheiro">Dinheiro</option>
                <option value="debito">Cart&#227;o d&#233;bito</option>
                <option value="credito">Cart&#227;o cr&#233;dito</option>
              </select>
            </label>
          </div>
          <div class="modal-actions">
            <button type="submit">Adicionar</button>
            <button type="reset" class="ghost">Limpar</button>
          </div>
        </form>
      </section>

      <section class="offerings-group admin-panel">
        <h2 class="offerings-title">Clientes cadastrados</h2>
        <div class="admin-actions">
          <p class="offerings-desc" style="margin: 0;">Lista gerada localmente no navegador.</p>
        </div>
        <div class="admin-table-wrap">
          <table class="admin-table" aria-describedby="listaClientes">
            <thead>
              <tr>
                <th>Cliente</th>
                <th>Parcelas</th>
                <th>Valor devedor</th>
                <th>Pagamento</th>
                <th>Status</th>
                <th>A&#231;&#245;es</th>
              </tr>
            </thead>
            <tbody id="clientTableBody">
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <footer class="foot">
      <p>Use esta p&#225;gina somente com autoriza&#231;&#227;o.</p>
    </footer>
  </div>

  <div class="toast" id="paidToast" role="status" aria-live="polite">
    <span class="toast-icon">&#10003;</span>
    <span id="paidToastText">Pagamento marcado.</span>
  </div>

  <div class="admin-modal" id="passwordModal" aria-hidden="true">
    <div class="admin-modal-backdrop" data-close="true"></div>
    <div class="admin-modal-panel" role="dialog" aria-modal="true" aria-labelledby="passwordTitle">
      <h2 id="passwordTitle">Confirmar pagamento</h2>
      <p class="admin-modal-subtitle">Digite a senha para marcar como pago.</p>
      <form id="passwordForm" class="admin-modal-form">
        <label>
          Senha
          <input type="password" id="passwordInput" autocomplete="current-password" required />
        </label>
        <div class="admin-modal-actions">
          <button type="submit">Confirmar</button>
          <button type="button" class="ghost" id="passwordCancel">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <div class="admin-modal" id="parcelModal" aria-hidden="true">
    <div class="admin-modal-backdrop" data-close="true"></div>
    <div class="admin-modal-panel" role="dialog" aria-modal="true" aria-labelledby="parcelTitle">
      <h2 id="parcelTitle">Parcelas do cliente</h2>
      <p class="admin-modal-subtitle">Valores arredondados para fechar o total.</p>
      <div id="parcelDetails"></div>
      <div class="admin-modal-actions">
        <button type="button" class="ghost" id="parcelClose">Fechar</button>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById("adminClientForm");
    const tableBody = document.getElementById("clientTableBody");
    const valorInput = document.getElementById("valor");
    const ADMIN_PASSWORD = "34713471";
    const paidToast = document.getElementById("paidToast");
    const paidToastText = document.getElementById("paidToastText");
    const passwordModal = document.getElementById("passwordModal");
    const passwordForm = document.getElementById("passwordForm");
    const passwordInput = document.getElementById("passwordInput");
    const passwordCancel = document.getElementById("passwordCancel");
    let entries = [];
    let toastTimer = null;
    let pendingPaidId = null;

    function escapeHtml(value) {
      return value
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function loadEntries() {
      const stored = localStorage.getItem("adminClients");
      entries = stored ? JSON.parse(stored) : [];
      renderEntries();
    }

    function appendRow(entry) {
      const row = document.createElement("tr");
      if (entry.pago) {
        row.classList.add("is-paid");
      }
      const statusLabel = entry.pago ? "Pago" : "Pendente";
      const actionLabel = entry.pago ? "Pago" : "Marcar como finalizado";
      row.innerHTML = "<td data-label=\"Cliente\">" +
        "<button type=\"button\" class=\"client-link\" data-id=\"" + entry.id + "\">" +
        escapeHtml(entry.cliente) + "</button></td>" +
        "<td data-label=\"Parcelas\">" + escapeHtml(entry.parcelas) + "</td>" +
        "<td data-label=\"Valor devedor\">R$ " + escapeHtml(entry.valor) + "</td>" +
        "<td data-label=\"Pagamento\">" + escapeHtml(entry.pagamentoLabel) + "</td>" +
        "<td data-label=\"Status\"><span class=\"status-pill\">" + statusLabel + "</span></td>" +
        "<td data-label=\"A&#231;&#245;es\">" +
          "<button type=\"button\" class=\"ghost mark-paid-btn\" data-id=\"" + entry.id + "\"" +
          (entry.pago ? " disabled" : "") + ">" + actionLabel + "</button>" +
        "</td>";
      tableBody.appendChild(row);
    }

    function saveEntries(entries) {
      localStorage.setItem("adminClients", JSON.stringify(entries));
    }

    function showToast(message) {
      if (!paidToast) return;
      if (paidToastText) {
        paidToastText.textContent = message;
      }
      paidToast.classList.add("show");
      if (toastTimer) {
        clearTimeout(toastTimer);
      }
      toastTimer = setTimeout(() => {
        paidToast.classList.remove("show");
      }, 2500);
    }

    function openPasswordModal(entryId) {
      if (!passwordModal) return;
      pendingPaidId = entryId;
      passwordModal.classList.add("open");
      passwordModal.setAttribute("aria-hidden", "false");
      if (passwordInput) {
        passwordInput.value = "";
        passwordInput.focus();
      }
    }

    function closePasswordModal() {
      if (!passwordModal) return;
      passwordModal.classList.remove("open");
      passwordModal.setAttribute("aria-hidden", "true");
      pendingPaidId = null;
      if (passwordForm) {
        passwordForm.reset();
      }
    }

    function renderEntries() {
      tableBody.innerHTML = "";
      entries.forEach((entry) => {
        appendRow(entry);
      });
    }

    if (form) {
      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const cliente = document.getElementById("cliente").value.trim();
        const parcelas = document.getElementById("parcelas").value.trim();
        const valor = document.getElementById("valor").value.trim();
        const pagamentoSelect = document.getElementById("pagamento");
        const pagamento = pagamentoSelect.value;
        const pagamentoLabel = pagamentoSelect.options[pagamentoSelect.selectedIndex].text;

        if (!cliente || !parcelas || !valor || !pagamento) {
          return;
        }

        const entry = {
          id: Date.now().toString(),
          cliente,
          parcelas,
          valor,
          pagamento,
          pagamentoLabel,
          pago: false
        };
        entries.push(entry);
        saveEntries(entries);
        renderEntries();
        form.reset();
      });
    }

    function formatMoneyInput(value) {
      const digits = value.replace(/\D/g, "");
      const padded = digits.padStart(3, "0");
      const cents = padded.slice(-2);
      const integer = padded.slice(0, -2);
      const integerFormatted = integer.replace(/^0+(?=\d)/, "") || "0";
      return integerFormatted + "," + cents;
    }

    if (valorInput) {
      valorInput.addEventListener("input", (event) => {
        const current = event.target.value;
        event.target.value = formatMoneyInput(current);
      });
    }

    if (tableBody) {
      tableBody.addEventListener("click", (event) => {
        const target = event.target;
        if (!target || !target.matches(".mark-paid-btn")) {
          return;
        }
        const id = target.getAttribute("data-id");
        openPasswordModal(id);
      });
    }

    if (passwordForm) {
      passwordForm.addEventListener("submit", (event) => {
        event.preventDefault();
        const password = passwordInput ? passwordInput.value : "";
        if (password !== ADMIN_PASSWORD) {
          alert("Senha incorreta.");
          return;
        }
        const entry = entries.find((item) => item.id === pendingPaidId);
        if (!entry || entry.pago) {
          closePasswordModal();
          return;
        }
        entry.pago = true;
        saveEntries(entries);
        renderEntries();
        closePasswordModal();
        showToast("Pagamento marcado como pago.");
      });
    }

    if (passwordCancel) {
      passwordCancel.addEventListener("click", () => {
        closePasswordModal();
      });
    }

    if (passwordModal) {
      passwordModal.addEventListener("click", (event) => {
        if (event.target && event.target.dataset && event.target.dataset.close === "true") {
          closePasswordModal();
        }
      });
    }

    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape" && passwordModal && passwordModal.classList.contains("open")) {
        closePasswordModal();
      }
    });

    loadEntries();
  </script>
</body>

</html>
